---
title: "GitBleed – Finding Secrets in Mirrored Git Repositories – CVE-2022-24975"
date: 2025-01-06
categories: 
  - "cybersecurity"
  - "cybersecurity-awareness"
  - "git"
  - "security"
  - "security-awareness"
tags: 
  - "gitbleed"
  - "github"
  - "gitlab"
---

## Summary

Due to a discrepancy in Git behavior, partial parts of a source code repository are visible when making copies via the “git clone” command. There are additional parts of the repository that only become visible when using the “–mirror” option. This can lead to secrets being exposed via git repositories when not removed properly, and a false sense of security when repositories are scanned for secrets against a cloned, non-mirrored copy.

Attackers and bug bounty hunters can use this discrepancy in Git behavior to find hidden secrets and other sensitive data in public repositories.

Organizations can mitigate this by analyzing a fuller copy of their repositories using the “–mirror” option and remove sensitive data using tools like BFG or git-filter-repo (which do a more thorough job).

MITRE assigned CVE-2022-24975 to track this issue.

**_\[ADDED APRIL 2022: This bug is NOT the same as NotGitBleed – see their website here\]_**

**\[ADDED JULY 2024: A more in-depth article on this issue from AquaSec\]**

## Technical Details

Git is a popular open source tool used for version control of source code. When users make a copy of a local or remote git repository, they use the “git clone” command. However, this command doesn’t copy all of the data in the originating repository such as deleted branches and commits. On the other hand, there is a “–mirror” option which copies more parts of the repository. The discrepancy between the two behaviors can lead to secrets and other sensitive data lingering in the original repository. Additionally, existing tools for secrets detection often operate on cloned repositories and do not detect secrets in the mirror portion of the repository unless cloned via the “–mirror” command.

**\[ADDED July 2024: More technical details are available in this blog post from AquaSec\]**

We also tested forking in GitHub and GitLab, and in both systems forking uses the regular “git clone” behind the scenes and not the “–mirror” version. That means that repositories containing secrets in the mirrored portion will not propagate those secrets to their forks.

MITRE assigned CVE-2022-24975 to track this issue.

We provide two examples of repositories containing hidden secrets that are only visible when cloning with the “–mirror” option. These can be found here:

- gb\_testrepo\_delete – secret is retained after a branch is deleted

- gb\_testrepo\_reset – secret is retained after the git history is reset

If you try to clone the repository without the “–mirror” option, and retrieve the secret, it will not work:

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/delete_clone.png?w=605)

And:

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/reset_clone.png?w=605)

If you try the same with the “–mirror” option, you can now retrieve the secret (also note the larger number of objects retrieved):

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/delete_mirror.png?w=669)

And:

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/reset_mirror.png?w=669)

If you run gitleaks on the cloned repositories, no secrets are found:

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/gitleaks_delete_clone.png?w=314)

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/gitleaks_delete_mirror.png?w=314)

However, running gitleaks on the mirrored copies, finds the secrets stashed in deleted areas:

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/gitleaks_reset_clone.png?w=437)

![](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/gitleaks_reset_mirror.png?w=437)

## Tooling

There are plenty of existing tools out there that can manipulate git repositories, scan them for secrets and remove specific commits. During our research, we used git for checking out repositories, git-filter-repo for figuring out the delta between cloned and mirrored copies of the same repository, and gitleaks to scan for secrets.

For examples on how to use these tools, please see sample scripts that we have published to GitHub.

## Mitigations

Organizations can mitigate this by analyzing a larger part of their repositories using the “–mirror” option and remove sensitive data using tools like BFG or git-filter-repo. Garbage collection and pruning in git is also recommended.

Organizations should not analyze regular cloned copies (without the “–mirror” option) since that may provide a false sense of security, and should not rely on methods of removing secrets such as deleting a branch or rewinding history via the “git reset” command.

## Branding

![logo](https://wwws.nightwatchcybersecurity.com/wp-content/uploads/2022/02/gitbleed_icon-3.png?w=383)

There seems to be a recent trend to name vulnerabilities. While we think it’s silly, why not go with the flow?

Therefore we named this one “**GitBleed**“, since it leads to bleeding of secrets from repositories – with a mirrored logo since it involves mirrored repositories.

## Changelog

2022-02-11: Initial publication

2022-02-26: Added CVE reference

2024-07-02: Added link to AquaSec

Go to Source
