---
title: "Following MITRE's footsteps in analyzing malware behavior"
date: 2025-01-05
categories: 
  - "cybersecurity"
  - "security"
  - "virus"
---

The **MITRE** framework helps all defenders speak the same language regarding attackers' modus operandi. VirusTotal provides multiple data points where MITRE's Tactics and Techniques are dynamically extracted from samples when detonated in our sandboxes. In particular, samples' MITRE mapping can be found under the **BEHAVIOR** tab of a file's report. This data is searchable in **VirusTotal Intelligence** (VTI) with the help of a set of specific file search modifiers.

In this article, we'll illustrate how security analysts can leverage MITRE for malware detection and **behavior**\-based hunting for ransomware and keylogger samples.

  

## Hunting for Ransomware

The security industry historically identified a set of commonly used techniques in **Ransomware** campaigns, including inhibiting the system recovery and discovering local files and network shares for later data encryption, usually combined with exfiltration and/or Command and Control techniques.

![](https://lh7-us.googleusercontent.com/Sfy6VIt1uPPGgGIT7Z4OOEy4n5e4EGFnrUc8gJ2vmA4iy11rIrhJpPX6OIwPyY_YPjBnUDV1DIMhp92EosShhWx7NOqD12EJRBmwiiMDHgVRZa9fn1HlU9vI9pkjwXtUWolJGT-bOSmDBKQYbkWNsZfo6svqfKZj37nls0NtB7rcyZYbDoopJBThzBuETUk)

_Common TTPs of modern ransomware groups by Kaspersky_

In VT Intelligence we can use 2 search modifiers to query files behavior mapped to MITRE ATT&CK:

- **"attack\_tactic"** search modifier followed by the MITRE Tactic ID returns the list of files that, based on our sandboxes analysis reports, execute techniques under the specified tactic. For example:
    - attack\_tactic: TA0040
    - attack\_tactic: TA0007
    - attack\_tactic: TA0010
    - attack\_tactic: TA0011
- **"attack\_technique"** search modifier followed by the MITRE Technique ID returns the list of files that, based on our sandboxes analysis reports, execute the specified technique. For example:
    - attack\_technique: T1490
    - attack\_technique: T1083
    - attack\_technique: T1135
    - attack\_technique: T1486

In addition to the **"attack\_tactic"** and **"attack\_technique"** modifiers, VirusTotal provides extra modifiers listed on the **Appendix I - Behavior search modifiers** for procedures-based queries at the end of this post.

Let's do an example. We want to find samples given a set of ransomware-related techniques combined with the **"behavior:CryptEncrypt"** operating system API call (check Appendix I for details). Additionally, we specify the **entity** we are interested in (**files**) and the first submission date (**fs**) to filter out files submitted before 2024-01-01.

The resulting query is as follows:

entity:file attack\_technique:T1490 and attack\_technique:T1083 and attack\_technique: T1135 behavior:CryptEncrypt fs:2024-01-01+

![](https://lh7-us.googleusercontent.com/CJODsRgXlRO5DIZJ9ALfH7vHfk1vrPeMrLeKyfHYyE6aEXcwOokaQnXdkAjPhAJOAKBCLYf2362tKYNFTahlJB2ROe-g7fjDU7VTHj46JPVJR2e1YIEFFYNNfShujhDgGOu_UNLIg7MBUVT4vCAyuSdzWPPtX0R3UoafZDZ9vmCQg3YHAa0YSpHNPk8kcto)

  

Let's analyze in more detail one of the query's resulting files (35619594724871138875db462eda6cf24f2a462e1f812ff27d79131576cd73ab). According to the community, the file belongs to a **BlackHunt** Ransomware campaign threat that compromised multiple companies in Paraguay.

Its BEHAVIOR report tab, provides details on the techniques detected during sample's detonation:

- **T1490** (**Inhibit System Recovery**), the sample deletes the shadow copies (as highlighted in the **Capabilities** section below) and it also modifies Windows boot settings via bcdedit.
    
    ![](https://lh7-us.googleusercontent.com/GkWcs4g1wyGjtX7Gim5nkkscFYUL3Ds9K7Ht4xannQdzbeuaHirXpHgJ2hi1Hrmm-gj7tHuDftp_GHp-S2iC4bgyM24tKiI_qZ9Au-S0hIXKYxJ4nhE_doq4GiJt2XiHDMsQ4f3fSDo83JM2wcLHM3-nFlHMS7-s1hkk-zDtSIoIIKAr1un5SnEdoy9E0Gs)
    

- **T1083** and **T1135**: The sample runs discovery processes to get system local files and directories, and also network shares.
    
    ![](https://lh7-us.googleusercontent.com/oKZGnV7KWtn9u0Yy8MnMtlCZwIGVXUXOBwFdPWAPW00neqvP8A38MPANlmR4bGjLH219ET8GYO8p4dIkU1KSa54QA7ZEykUw5n7XgolaBb3rixmk81BRH4gyGiwH-cjqNZO-OJrpAH94B8U1TX6xe2O4UpvHnxge268SlAtNx6egYLmq17Jz7CEVH5yyguk)
    

- The encryption process is visible by the CryptEncrypt operating system API call, functionality provided by the **Advapi32.dll**, and visible under the file's DETAILS tab.
    
    ![](https://lh7-us.googleusercontent.com/GxvYOSdtoJ1hxfTpVPsWoyRC8Ik-qtVZajTc2QrekN_29V8_YHRz5tc357B4L2jen-Te-IAJDToYxV6aY27TTeIJrg9w2EqrcGtXksE2T1uoTfHqiaK1kVLlQfUUN40IpToKphY01wbEkX58H1ygvhkIhmqwnp2OtWavnAV275sW_AK_g_UxKAoZ3DAq4yg)
    

  

## Hunting for Keyloggers

**Keyloggers** are a particular form of Spyware designed for stealing user data, that commonly share some MITRE Tactics, including collecting data and/or discovering data for later exfiltration and/or Command and Control communication.

For our VTI query we will specify the T1056.001: Input Capture: Keylogging sub-technique of the Collection tactic, which identifies keystrokes interception. Additionally, we use the first submitted time condition (**fs**) and both **Command and Control** or **Exfiltration** tactics (**attack\_tactic**), since we are not really interested in restricting the way the data gets outside of the victim environment.

attack\_technique:T1056.001 (attack\_tactic:TA0011 OR attack\_tactic:TA0010) fs:2024-02-15+

![](https://lh7-us.googleusercontent.com/-B4K35DvGOsz_IIGSlWO5eRuPTx-OEhP08ahdtobWk0LbRz-Bt3Irdr4y1sbbHVmPIUzwQ7aySSTy6fy0PArgeRKC6jcBRp00g3HumoUhcPLN31Vm5KmBDlDRm7F8vGbqR3ZILBRLfeWcvB5XbJbuBv52yRHQT9HGGzcJk9Nu0MhNTm2jqnNMl5ADWPgJUI)

  

One of the retrieved files (975b67e75c046e95b1f418c2db85a726dc5d38c21853c5446393b9805c6d1bd5) with a 25 out of 71 AV detection ratio is cataloged as **Remcos**, a commercial Remote Access Tool with keylogger capabilities among many others, which has been used by several Threat Actors.

![](https://lh7-us.googleusercontent.com/GsrIzvLh4clPjXTI-wtMyXA60VmHMhT4udY_kIwH48EKWbBRF3uDeuEMRV5P2mzqj-fn5xOD1xyit9WcJW4IYOamF2IxNcfnwhujYIe8A8s5--YaYHh2cH1rXyOCqoSmzmvOR29bk1XGBkPcZkF2ZEfyjEuO3wu1HP5fn9oZUvNdyTUQg5Ew3yaYU4BjZA4)

On its BEHAVIOR tab, we can see details on the **keystrokes** interception performed via polling method. The report also reveals additional functionality, including capturing **screenshots**, reading victims' **clipboard** and **geographical location** of the abused device.

 ![](https://lh7-us.googleusercontent.com/oVUN_Y5ynmn3F4nWGc_UsJekYSEgb20gNrjVpih3BA98sdC3C_GrrKH-f0TwLNAFHnIm9AhMojZNKFKE-ek4xbQk2VNrYE0tSGzRwA1jPhryglQMULHcDI4oM7fBxW9BdO1SYLXvbmX6Zrbd0TJDCX21OLB32byPjZnjt9tAHYevpU3MhMC57MP_qBJpAnU)![](https://lh7-us.googleusercontent.com/dyRx0PhSvYzDjYGUS2h5W4kwWkNIx3I6axLfGytWY5kvewsw8XaPj2co5P8WAqAT_pxnJVrtldRLKXOVRlfQTzQOtNo90LVrjpqn1vm_tz-5QHxJ7L1nj_HOPtvGcVPAuUW7jIqSCkfEREbshJfj1lm-jzp-QhIjq0sGV26S5Lrzp7VGL8pAkhayd4xDA3U)

  

## Conclusions

In this post we have seen using a couple of examples how present the **MITRE** framework is on VirusTotal and how it can be used to search for files with a particular TTP-based behavior using **VirusTotal Intelligence** searches. MITRE-related data is based on behavior detected during samples' sandbox detonation.

We have additionally created an Appendix I (below) detailing some of the most interesting behavior-search modifiers you can use in your queries. This fits particularly well with other TTP-based modifiers, allowing you to refine results by adding particular technical characteristics specific for the malware under analysis.

We hope you found this post interesting and useful. For suggestions or feedback please feel free to reach out here, we will be happy to hear from you.

Happy hunting!

  

## Appendix I - Behavior search modifiers

The following search modifiers provide a more granular way of searching files based on their behavior, allowing more restrictive queries while using **Tactics/Techniques** (**"attack\_tactic"**, **"attack\_technique"**) search modifiers.

- **"behavior\_processes"**: followed by the executable and parameters used to run during the sample dynamic analysis:

- behavior\_processes:"\\vssadmin.exe delete shadows /all /quiet"
- behavior\_processes:"wbadmin.exe delete catalog -quiet"
- behavior\_processes:" tree c:\\"

- **"behavior\_injected\_processes"**: followed by the executable name with or without extension:

- behavior\_injected\_processes:lsass.exe
- behavior\_injected\_processes:Wininit.exe

- **"behavior\_created\_processes"**: followed by the executable name with or without extension:

- behavior\_created\_processes: Wininit.exe NOT name:Wininit.exe

- **"behavior\_services"**: followed by the service name to get files opening or deleting internal services:

- behavior\_services: sysmon

- **"behavior\_registry"**: followed by a system registry key to check for new, deleted or modified registry keys:

- behavior\_registry:"SoftwareMicrosoftWindowsCurrentVersionRun"

- **"behavior\_network"**: followed by an URL, domain or IP address to identify files communicating with those network elements:

- behavior\_network:ip-api.com

- **"behavior\_files"**: followed by the file name with or without extension and/or path to identify files that were opened, written, deleted or dropped:

- behavior\_files: "C:ProgramDataVaccine.txt"
- behavior\_files: "MicrosoftWindowsStart MenuProgramsStartup\*"

- **"behavior"**: all the previous search modifiers in the appendix can be replaced by this one. It matches against the whole file behavior report and provides a way to check for other data that doesn't have a specific search modifier assigned:

- **API calls**: **Calls Highlighted** subsection under **Highlighted actions** section of a file behavior report:

- behavior: CryptEncrypt
- behavior: IsDebuggerPresent
- behavior: IsWow64Process
- behavior: GetSystemMetrics
- behavior: GetAsyncKeyState

- **Mutexes** created or opened, under the **Synchronization mechanisms & Signals** section of a file behavior report:

- behavior:BLACK\_HUNT\_MUTEX

- **Modules loaded** section of a file behavior report:

- behavior:CRYPTSP.DLL

- **"behavior\_tags"**: followed by the tag of your interest to get files assigned with the indicated tag that you can check here.

- behavior\_tags:detect\_debug\_environment

The **MITRE** framework helps all defenders speak the same language regarding attackers' modus operandi. VirusTotal provides multiple data points where MITRE's Tactics and Techniques are dynamically extracted from samples when detonated in our sandboxes. In particular, samples' MITRE mapping can be found under the **BEHAVIOR** tab of a file's report. This data is searchable in **VirusTotal Intelligence** (VTI) with the help of a set of specific file search modifiers.

In this article, we'll illustrate how security analysts can leverage MITRE for malware detection and **behavior**\-based hunting for ransomware and keylogger samples.

  

## Hunting for Ransomware

The security industry historically identified a set of commonly used techniques in **Ransomware** campaigns, including inhibiting the system recovery and discovering local files and network shares for later data encryption, usually combined with exfiltration and/or Command and Control techniques.

![](https://lh7-us.googleusercontent.com/Sfy6VIt1uPPGgGIT7Z4OOEy4n5e4EGFnrUc8gJ2vmA4iy11rIrhJpPX6OIwPyY_YPjBnUDV1DIMhp92EosShhWx7NOqD12EJRBmwiiMDHgVRZa9fn1HlU9vI9pkjwXtUWolJGT-bOSmDBKQYbkWNsZfo6svqfKZj37nls0NtB7rcyZYbDoopJBThzBuETUk)

_Common TTPs of modern ransomware groups by Kaspersky_

In VT Intelligence we can use 2 search modifiers to query files behavior mapped to MITRE ATT&CK:

- **"attack\_tactic"** search modifier followed by the MITRE Tactic ID returns the list of files that, based on our sandboxes analysis reports, execute techniques under the specified tactic. For example:
    - attack\_tactic: TA0040
    - attack\_tactic: TA0007
    - attack\_tactic: TA0010
    - attack\_tactic: TA0011
- **"attack\_technique"** search modifier followed by the MITRE Technique ID returns the list of files that, based on our sandboxes analysis reports, execute the specified technique. For example:
    - attack\_technique: T1490
    - attack\_technique: T1083
    - attack\_technique: T1135
    - attack\_technique: T1486

In addition to the **"attack\_tactic"** and **"attack\_technique"** modifiers, VirusTotal provides extra modifiers listed on the **Appendix I - Behavior search modifiers** for procedures-based queries at the end of this post.

Let's do an example. We want to find samples given a set of ransomware-related techniques combined with the **"behavior:CryptEncrypt"** operating system API call (check Appendix I for details). Additionally, we specify the **entity** we are interested in (**files**) and the first submission date (**fs**) to filter out files submitted before 2024-01-01.

The resulting query is as follows:

entity:file attack\_technique:T1490 and attack\_technique:T1083 and attack\_technique: T1135 behavior:CryptEncrypt fs:2024-01-01+

![](https://lh7-us.googleusercontent.com/CJODsRgXlRO5DIZJ9ALfH7vHfk1vrPeMrLeKyfHYyE6aEXcwOokaQnXdkAjPhAJOAKBCLYf2362tKYNFTahlJB2ROe-g7fjDU7VTHj46JPVJR2e1YIEFFYNNfShujhDgGOu_UNLIg7MBUVT4vCAyuSdzWPPtX0R3UoafZDZ9vmCQg3YHAa0YSpHNPk8kcto)

  

Let's analyze in more detail one of the query's resulting files (35619594724871138875db462eda6cf24f2a462e1f812ff27d79131576cd73ab). According to the community, the file belongs to a **BlackHunt** Ransomware campaign threat that compromised multiple companies in Paraguay.

Its BEHAVIOR report tab, provides details on the techniques detected during sample's detonation:

- **T1490** (**Inhibit System Recovery**), the sample deletes the shadow copies (as highlighted in the **Capabilities** section below) and it also modifies Windows boot settings via bcdedit.
    
    ![](https://lh7-us.googleusercontent.com/GkWcs4g1wyGjtX7Gim5nkkscFYUL3Ds9K7Ht4xannQdzbeuaHirXpHgJ2hi1Hrmm-gj7tHuDftp_GHp-S2iC4bgyM24tKiI_qZ9Au-S0hIXKYxJ4nhE_doq4GiJt2XiHDMsQ4f3fSDo83JM2wcLHM3-nFlHMS7-s1hkk-zDtSIoIIKAr1un5SnEdoy9E0Gs)
    

- **T1083** and **T1135**: The sample runs discovery processes to get system local files and directories, and also network shares.
    
    ![](https://lh7-us.googleusercontent.com/oKZGnV7KWtn9u0Yy8MnMtlCZwIGVXUXOBwFdPWAPW00neqvP8A38MPANlmR4bGjLH219ET8GYO8p4dIkU1KSa54QA7ZEykUw5n7XgolaBb3rixmk81BRH4gyGiwH-cjqNZO-OJrpAH94B8U1TX6xe2O4UpvHnxge268SlAtNx6egYLmq17Jz7CEVH5yyguk)
    

- The encryption process is visible by the CryptEncrypt operating system API call, functionality provided by the **Advapi32.dll**, and visible under the file's DETAILS tab.
    
    ![](https://lh7-us.googleusercontent.com/GxvYOSdtoJ1hxfTpVPsWoyRC8Ik-qtVZajTc2QrekN_29V8_YHRz5tc357B4L2jen-Te-IAJDToYxV6aY27TTeIJrg9w2EqrcGtXksE2T1uoTfHqiaK1kVLlQfUUN40IpToKphY01wbEkX58H1ygvhkIhmqwnp2OtWavnAV275sW_AK_g_UxKAoZ3DAq4yg)
    

  

## Hunting for Keyloggers

**Keyloggers** are a particular form of Spyware designed for stealing user data, that commonly share some MITRE Tactics, including collecting data and/or discovering data for later exfiltration and/or Command and Control communication.

For our VTI query we will specify the T1056.001: Input Capture: Keylogging sub-technique of the Collection tactic, which identifies keystrokes interception. Additionally, we use the first submitted time condition (**fs**) and both **Command and Control** or **Exfiltration** tactics (**attack\_tactic**), since we are not really interested in restricting the way the data gets outside of the victim environment.

attack\_technique:T1056.001 (attack\_tactic:TA0011 OR attack\_tactic:TA0010) fs:2024-02-15+

![](https://lh7-us.googleusercontent.com/-B4K35DvGOsz_IIGSlWO5eRuPTx-OEhP08ahdtobWk0LbRz-Bt3Irdr4y1sbbHVmPIUzwQ7aySSTy6fy0PArgeRKC6jcBRp00g3HumoUhcPLN31Vm5KmBDlDRm7F8vGbqR3ZILBRLfeWcvB5XbJbuBv52yRHQT9HGGzcJk9Nu0MhNTm2jqnNMl5ADWPgJUI)

  

One of the retrieved files (975b67e75c046e95b1f418c2db85a726dc5d38c21853c5446393b9805c6d1bd5) with a 25 out of 71 AV detection ratio is cataloged as **Remcos**, a commercial Remote Access Tool with keylogger capabilities among many others, which has been used by several Threat Actors.

![](https://lh7-us.googleusercontent.com/GsrIzvLh4clPjXTI-wtMyXA60VmHMhT4udY_kIwH48EKWbBRF3uDeuEMRV5P2mzqj-fn5xOD1xyit9WcJW4IYOamF2IxNcfnwhujYIe8A8s5--YaYHh2cH1rXyOCqoSmzmvOR29bk1XGBkPcZkF2ZEfyjEuO3wu1HP5fn9oZUvNdyTUQg5Ew3yaYU4BjZA4)

On its BEHAVIOR tab, we can see details on the **keystrokes** interception performed via polling method. The report also reveals additional functionality, including capturing **screenshots**, reading victims' **clipboard** and **geographical location** of the abused device.

 ![](https://lh7-us.googleusercontent.com/oVUN_Y5ynmn3F4nWGc_UsJekYSEgb20gNrjVpih3BA98sdC3C_GrrKH-f0TwLNAFHnIm9AhMojZNKFKE-ek4xbQk2VNrYE0tSGzRwA1jPhryglQMULHcDI4oM7fBxW9BdO1SYLXvbmX6Zrbd0TJDCX21OLB32byPjZnjt9tAHYevpU3MhMC57MP_qBJpAnU)![](https://lh7-us.googleusercontent.com/dyRx0PhSvYzDjYGUS2h5W4kwWkNIx3I6axLfGytWY5kvewsw8XaPj2co5P8WAqAT_pxnJVrtldRLKXOVRlfQTzQOtNo90LVrjpqn1vm_tz-5QHxJ7L1nj_HOPtvGcVPAuUW7jIqSCkfEREbshJfj1lm-jzp-QhIjq0sGV26S5Lrzp7VGL8pAkhayd4xDA3U)

  

## Conclusions

In this post we have seen using a couple of examples how present the **MITRE** framework is on VirusTotal and how it can be used to search for files with a particular TTP-based behavior using **VirusTotal Intelligence** searches. MITRE-related data is based on behavior detected during samples' sandbox detonation.

We have additionally created an Appendix I (below) detailing some of the most interesting behavior-search modifiers you can use in your queries. This fits particularly well with other TTP-based modifiers, allowing you to refine results by adding particular technical characteristics specific for the malware under analysis.

We hope you found this post interesting and useful. For suggestions or feedback please feel free to reach out here, we will be happy to hear from you.

Happy hunting!

  

## Appendix I - Behavior search modifiers

The following search modifiers provide a more granular way of searching files based on their behavior, allowing more restrictive queries while using **Tactics/Techniques** (**"attack\_tactic"**, **"attack\_technique"**) search modifiers.

- **"behavior\_processes"**: followed by the executable and parameters used to run during the sample dynamic analysis:

- behavior\_processes:"\\vssadmin.exe delete shadows /all /quiet"
- behavior\_processes:"wbadmin.exe delete catalog -quiet"
- behavior\_processes:" tree c:\\"

- **"behavior\_injected\_processes"**: followed by the executable name with or without extension:

- behavior\_injected\_processes:lsass.exe
- behavior\_injected\_processes:Wininit.exe

- **"behavior\_created\_processes"**: followed by the executable name with or without extension:

- behavior\_created\_processes: Wininit.exe NOT name:Wininit.exe

- **"behavior\_services"**: followed by the service name to get files opening or deleting internal services:

- behavior\_services: sysmon

- **"behavior\_registry"**: followed by a system registry key to check for new, deleted or modified registry keys:

- behavior\_registry:"SoftwareMicrosoftWindowsCurrentVersionRun"

- **"behavior\_network"**: followed by an URL, domain or IP address to identify files communicating with those network elements:

- behavior\_network:ip-api.com

- **"behavior\_files"**: followed by the file name with or without extension and/or path to identify files that were opened, written, deleted or dropped:

- behavior\_files: "C:ProgramDataVaccine.txt"
- behavior\_files: "MicrosoftWindowsStart MenuProgramsStartup\*"

- **"behavior"**: all the previous search modifiers in the appendix can be replaced by this one. It matches against the whole file behavior report and provides a way to check for other data that doesn't have a specific search modifier assigned:

- **API calls**: **Calls Highlighted** subsection under **Highlighted actions** section of a file behavior report:

- behavior: CryptEncrypt
- behavior: IsDebuggerPresent
- behavior: IsWow64Process
- behavior: GetSystemMetrics
- behavior: GetAsyncKeyState

- **Mutexes** created or opened, under the **Synchronization mechanisms & Signals** section of a file behavior report:

- behavior:BLACK\_HUNT\_MUTEX

- **Modules loaded** section of a file behavior report:

- behavior:CRYPTSP.DLL

- **"behavior\_tags"**: followed by the tag of your interest to get files assigned with the indicated tag that you can check here.

- behavior\_tags:detect\_debug\_environment

Go to Source
