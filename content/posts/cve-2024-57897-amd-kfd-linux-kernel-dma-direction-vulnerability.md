---
title: "CVE-2024-57897 - AMD KFD Linux Kernel DMA Direction Vulnerability"
date: 2025-01-15
categories: 
  - "cve"
  - "cybersecurity"
  - "cybersecurity-awareness"
  - "security"
  - "threat-intelligence"
tags: 
  - "cve"
  - "cybersecurity"
  - "security"
---

**CVE ID :** CVE-2024-57897  
**Published :** Jan. 15, 2025, 1:15 p.m. | 1 hour, 2 minutes ago  
**Description :** In the Linux kernel, the following vulnerability has been resolved:

drm/amdkfd: Correct the migration DMA map direction

The SVM DMA device map direction should be set the same as the DMA unmap setting, otherwise the DMA core will report the following warning.

Before finialize this solution, there're some discussion on the DMA mapping type(stream-based or coherent) in this KFD migration case, followed by https://lore.kernel.org/all/04d4ab32 -45a1-4b88-86ee-fb0f35a0ca40@amd.com/T/.

As there's no dma\_sync\_single\_for\_\*() in the DMA buffer accessed that because this migration operation should be sync properly and automatically. Give that there's might not be a performance problem in various cache sync policy of DMA sync. Therefore, in order to simplify the DMA direction setting alignment, let's set the DMA map direction as BIDIRECTIONAL.

\[ 150.834218\] WARNING: CPU: 8 PID: 1812 at kernel/dma/debug.c:1028 check\_unmap+0x1cc/0x930 \[ 150.834225\] Modules linked in: amdgpu(OE) amdxcp drm\_exec(OE) gpu\_sched drm\_buddy(OE) drm\_ttm\_helper(OE) ttm(OE) drm\_suballoc\_helper(OE) drm\_display\_helper(OE) drm\_kms\_helper(OE) i2c\_algo\_bit rpcsec\_gss\_krb5 auth\_rpcgss nfsv4 nfs lockd grace netfs xt\_conntrack xt\_MASQUERADE nf\_conntrack\_netlink xfrm\_user xfrm\_algo iptable\_nat xt\_addrtype iptable\_filter br\_netfilter nvme\_fabrics overlay nfnetlink\_cttimeout nfnetlink openvswitch nsh nf\_conncount nf\_nat nf\_conntrack nf\_defrag\_ipv6 nf\_defrag\_ipv4 libcrc32c bridge stp llc sch\_fq\_codel intel\_rapl\_msr amd\_atl intel\_rapl\_common snd\_hda\_codec\_realtek snd\_hda\_codec\_generic snd\_hda\_scodec\_component snd\_hda\_codec\_hdmi snd\_hda\_intel snd\_intel\_dspcfg edac\_mce\_amd snd\_pci\_acp6x snd\_hda\_codec snd\_acp\_config snd\_hda\_core snd\_hwdep snd\_soc\_acpi kvm\_amd sunrpc snd\_pcm kvm binfmt\_misc snd\_seq\_midi crct10dif\_pclmul snd\_seq\_midi\_event ghash\_clmulni\_intel sha512\_ssse3 snd\_rawmidi nls\_iso8859\_1 sha256\_ssse3 sha1\_ssse3 snd\_seq aesni\_intel snd\_seq\_device crypto\_simd snd\_timer cryptd input\_leds \[ 150.834310\] wmi\_bmof serio\_raw k10temp rapl snd sp5100\_tco ipmi\_devintf soundcore ccp ipmi\_msghandler cm32181 industrialio mac\_hid msr parport\_pc ppdev lp parport efi\_pstore drm(OE) ip\_tables x\_tables pci\_stub crc32\_pclmul nvme ahci libahci i2c\_piix4 r8169 nvme\_core i2c\_designware\_pci realtek i2c\_ccgx\_ucsi video wmi hid\_generic cdc\_ether usbnet usbhid hid r8152 mii \[ 150.834354\] CPU: 8 PID: 1812 Comm: rocrtst64 Tainted: G OE 6.10.0-custom #492 \[ 150.834358\] Hardware name: AMD Majolica-RN/Majolica-RN, BIOS RMJ1009A 06/13/2021 \[ 150.834360\] RIP: 0010:check\_unmap+0x1cc/0x930 \[ 150.834363\] Code: c0 4c 89 4d c8 e8 34 bf 86 00 4c 8b 4d c8 4c 8b 45 c0 48 8b 4d b8 48 89 c6 41 57 4c 89 ea 48 c7 c7 80 49 b4 84 e8 b4 81 f3 ff <0f> 0b 48 c7 c7 04 83 ac 84 e8 76 ba fc ff 41 8b 76 4c 49 8d 7e 50 \[ 150.834365\] RSP: 0018:ffffaac5023739e0 EFLAGS: 00010086 \[ 150.834368\] RAX: 0000000000000000 RBX: ffffffff8566a2e0 RCX: 0000000000000027 \[ 150.834370\] RDX: ffff8f6a8f621688 RSI: 0000000000000001 RDI: ffff8f6a8f621680 \[ 150.834372\] RBP: ffffaac502373a30 R08: 00000000000000c9 R09: ffffaac502373850 \[ 150.834373\] R10: ffffaac502373848 R11: ffffffff84f46328 R12: ffffaac502373a40 \[ 150.834375\] R13: ffff8f6741045330 R14: ffff8f6741a77700 R15: ffffffff84ac831b \[ 150.834377\] FS: 00007faf0fc94c00(0000) GS:ffff8f6a8f600000(0000) knlGS:0000000000000000 \[ 150.834379\] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 \[ 150.834381\] CR2: 00007faf0b600020 CR3: 000000010a52e000 CR4: 0000000000350ef0 \[ 150.834383\] Call Trace: \[ 150.834385\] \[ 150.834387\] ? show\_regs+0x6d/0x80 \[ 150.834393\] ? \_\_warn+0x8c/0x140 \[ 150.834397\] ? check\_unmap+0x1cc/0x930 \[ 150.834400\] ? report\_bug+0x193/0x1a0 \[ 150.834406\] ? handle\_bug+0x46/0x80 \[ 150.834410\] ? exc\_invalid\_op+0x1d/0x80 \[ 150.834413\] ? asm\_exc\_invalid\_op+0x1f/0x30 \[ 150.834420\] ? check\_unmap+0x1cc/0x930 \[ 150.834425\] debug\_dma\_unmap\_page+0x86/0x90 \[ 150.834431\] ? srso\_return\_thunk+0x5/0x5f \[ 150.834435\] ---truncated--- 
**Severity:** 0.0 | NA  
Visit the link for more details, such as CVSS details, affected products, timeline, and more...

Go to Source
