<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>What is a while2 loop in Hex-Rays</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	==========================<br>
	== <a href="https://ghariib.ir/">Gharib Personal Blog</a> ==<br>
	==========================
	<div style="float: right;">A Techi Personal Blog</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Posts</b></a>.
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>What is a while2 loop in Hex-Rays</h1>
			<b><time>03.03.2021 23:59</time></b>
		       

			<div>
				<h1 id="what-is-a-while2-loop-in-hex-rays">What is a while2 loop in Hex-Rays</h1>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>
<figure>
  <img src="https://images.squarespace-cdn.com/content/v1/53a64cc2e4b0c63fc41a3320/1614815319717-D85HI28B45S200VISPLM/while2.png?format=1000w" alt="" />
</figure>


</p>
<p>Logically, <code>while(2)</code> behaves the same as <code>while(1)</code> &ndash; both loops are infinite &ndash; but I wondered where they came from, what they meant, and why Hex-Rays produces them. Given that somebody asked me about it on Twitter, it&rsquo;s clear that I&rsquo;m not the only one who&rsquo;s had this question. I recently learned the answer, so I decided to document it for posterity.</p>
<p>Answering this question requires some discussion of Hex-Rays internals. The decompiler operates in two major phases, known internally as &ldquo;microcode&rdquo; and &ldquo;ctree&rdquo;. The microcode phase covers the core decompilation logic, such as: translating the assembly instructions into an intermediate representation; applying compiler-esque transformations such as data flow analysis, constant propagation, forward substitution, dead store elimination, and so on; analyzing function calls; and more. To learn more, I&rsquo;d recommend reading <a href="https://www.hex-rays.com/blog/microcode-in-pictures/">Ilfak&rsquo;s blog entry</a> and installing the <a href="https://github.com/gaasedelen/lucid">Lucid microcode explorer</a>.</p>
<p>The ctree analysis phases, on the other hand, are more focused on the listing that gets presented to the user. The ctree phase contains relatively little code that resembles standard compiler optimizations &ndash; some pattern transformations are close &ndash; whereas much of the code in the microcode phase resembles standard compiler analysis. The major differences between the two are that the microcode does not have high-level control flow structures such as loops (it uses <code>goto</code> statements and assembly-like conditional branches instead), and that type information plays a relatively minor role in the microcode phase, whereas it plays a major role in the ctree phase.</p>
<p>Between the microcode and ctree phases, there is a brief phase known internally as <code>hxe_structural</code>, which performs so-called &ldquo;structural analysis&rdquo;. This phase operates on the final microcode, after all analysis and transformation, but before the ctree has been constructed. Its role is to determine which high-level control flow structures should be presented to the user in the ctree listing. I.e., the information generated by this phase is used during ctree generation to create <code>if</code>, <code>if/else</code>, <code>while</code>, <code>do/while</code>, <code>switch</code>, and <code>goto</code> statements.</p>
<p>After ctree generation is complete, Hex-Rays applies two sets of transformations (known internally as <code>CMAT_TRANS1</code> and <code>CMAT_TRANS2</code>) to the decompilation listing, to clean up common patterns of suboptimal output. For example, given the following code:</p>
<pre tabindex="0"><code>if(cond) {
</code></pre><pre tabindex="0"><code>  result = 1;
</code></pre><pre tabindex="0"><code>  goto label_X;
</code></pre><pre tabindex="0"><code>}
</code></pre><pre tabindex="0"><code>// ...
</code></pre><pre tabindex="0"><code>label_X:
</code></pre><pre tabindex="0"><code>return result;
</code></pre><p>Hex-Rays will convert this into simply <code>if(cond) return 1;</code>. These phases might also transform <code>while</code> loops into <code>for</code> loops, rewrite <code>while</code> loops as <code>do-while</code> loops or vice versa, convert <code>while(1) { if(cond) break; /* ... */ }</code> to <code>while(!cond) { /*...*/ }</code>, and so on.</p>
<p>There is one transformation in the <code>CMAT_TRANS2</code> phase that is capable of creating a loop where none previously existed. Namely, it looks for patterns of instructions like the following:</p>
<pre tabindex="0"><code>label_X:
</code></pre><pre tabindex="0"><code>/* ... */
</code></pre><pre tabindex="0"><code>goto label_X;
</code></pre><p>Importantly, the label and the goto must be in the same scope (i.e. inside of the same set of curly braces <code>{</code> <code>}</code>). If this pattern matches &ndash; and the code inside satisfies a few technical restrictions &ndash; Hex-Rays will create a <code>while(2) { /* ... */ }</code>.</p>
<p><code>while(2)</code> loops are created at <code>CMAT_TRANS2</code>, whereas the other loop transformations mentioned previously take place at <code>CMAT_TRANS1</code>. Therefore, <code>while(2)</code> loops will not be rewritten as a <code>while</code> loop with a conditional, or a <code>do/while</code> loop, or a <code>for</code> loop. If Hex-Rays creates a <code>while(2)</code> loop internally, there will always be a <code>while(2)</code> loop in the final output.</p>
<p>So the short answer to the question is: it doesn&rsquo;t matter what a <code>while(2)</code> loop is. When you see one, you have no reason to think of it any differently from a <code>while(1)</code> loop. Hex-Rays is not trying to communicate anything special to you as a user. <code>while(2)</code> loops are introduced to improve the decompilation listing for common patterns that the structuring algorithms are unable to recognize, for whatever reason. (This is a common pattern in compiler design &ndash; having a set of rewrite rules that can clean up suboptimal results of previous phases. For example, peephole optimizers in compilers operate on a similar principle.)</p>
<h4 id="source"><a href="https://www.msreverseengineering.com/blog/2021/3/3/what-is-a-while2-loop-in-hex-rays">Source</a></h4>
<!-- raw HTML omitted -->

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/2025-03-20-laser-harp-sets-the-tone/">Laser Harp Sets the Tone</a></li>
				
				<li><a href="/posts/2025-03-20-arduino-device-helps-split-the-g-on-a-p/">Arduino device helps split the G on a pint of Guinness</a></li>
				
				<li><a href="/posts/2025-03-20-the-70-best-early-amazon-spring-sale-ga/">The 70 best early Amazon Spring Sale gaming deals 2025</a></li>
				
				<li><a href="/posts/2025-03-20-tomorrow-and-tomorrow-and-tomorrow-info/">Tomorrow and tomorrow and tomorrow Information security and the Baseball Hall of Fame</a></li>
				
				<li><a href="/posts/2025-03-20-i-found-an-android-phone-that-can-convi/">I found an Android phone that can convince iPhone users to make the switch - and its not a flagship</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 <a href="https://ghariib.ir/"><b>Alireza Gharib. All right reserved</b></a>.
	<a href="https://github.com/Gharib110"><b>Github</b></a>.
	</p>
</footer>

</body>
</html>
