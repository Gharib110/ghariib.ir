<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>The AWS Exploit That Lets Hackers Take Over Your Cloud – Without You Knowing!</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	==========================<br>
	== <a href="https://ghariib.ir/">Gharib Personal Blog</a> ==<br>
	==========================
	<div style="float: right;">A Techi Personal Blog</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Posts</b></a>.
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>The AWS Exploit That Lets Hackers Take Over Your Cloud – Without You Knowing!</h1>
			<b><time>19.03.2025 00:00</time></b>
		       

			<div>
				<p>Cloud security remains an evolving challenge as new attack vectors emerge, often leveraging misconfigurations rather than outright software vulnerabilities. In August 2024, researchers at <strong>Datadog Security Labs</strong> uncovered a novel <strong>name confusion attack</strong> that exploits a misconfiguration in the way <strong>Amazon Machine Images (AMIs)</strong> are retrieved within AWS environments. This attack, dubbed <strong>whoAMI</strong>, enables adversaries to execute arbitrary code within AWS accounts by manipulating AMI selection mechanisms.</p>
<p>This report provides an in-depth analysis of the <strong>whoAMI attack</strong>, its underlying mechanisms, real-world impact, mitigation strategies, and best practices for cloud security professionals.</p>
<hr>
<h2 id="understanding-the-whoami-attack"><strong>Understanding the whoAMI Attack</strong></h2>
<h3 id="the-role-of-amis-in-aws-infrastructure"><strong>The Role of AMIs in AWS Infrastructure</strong></h3>
<p>Amazon Machine Images (<strong>AMIs</strong>) are fundamental components in AWS environments, serving as <strong>pre-configured virtual machine templates</strong> used to launch EC2 instances. Organizations utilize AMIs for provisioning infrastructure efficiently, whether through <strong>publicly available images, community-contributed images, or proprietary private images</strong>.</p>
<p>Typically, AWS users searching for the latest OS-based AMI—such as Ubuntu or Amazon Linux—leverage the <strong>DescribeImages API</strong> to dynamically fetch the most recent image. However, the whoAMI attack exploits a specific misconfiguration in <strong>how these AMIs are retrieved</strong>.</p>
<h3 id="attack-mechanism-exploiting-name-confusion"><strong>Attack Mechanism: Exploiting Name Confusion</strong></h3>
<p>The whoAMI attack is a <strong>variant of a name confusion attack</strong>, which is a subset of <strong>supply chain attacks</strong>. Similar to <strong>dependency confusion attacks</strong>, this attack <strong>tricks misconfigured systems into selecting a malicious resource</strong> instead of a legitimate one. However, instead of software dependencies, the targeted resource is a <strong>virtual machine image (AMI).</strong></p>
<p>The attack works as follows:</p>
<ol>
<li>
<p><strong>The Vulnerability</strong></p>
<ul>
<li>
<p>Organizations often use AWS APIs or Infrastructure-as-Code (IaC) tools like Terraform to fetch AMIs dynamically.</p>
</li>
<li>
<p>A common method is to search for AMIs using <strong>wildcard patterns</strong> (e.g., fetching the latest <code>Ubuntu-20.04</code> AMI).</p>
</li>
<li>
<p>The API call often <strong>omits the “owner” parameter</strong>, allowing results to include <strong>both official and third-party AMIs</strong>.</p>
</li>
</ul>
</li>
<li>
<p><strong>Adversary’s Exploitation</strong></p>
<ul>
<li>
<p>An attacker <strong>publishes a malicious AMI</strong> with a <strong>name that matches an expected pattern</strong> (e.g., <code>ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*</code>).</p>
</li>
<li>
<p>They <strong>timestamp it to be the most recent version</strong>, ensuring that any query retrieving the latest AMI <strong>unknowingly selects the attacker’s image.</strong></p>
</li>
<li>
<p>Once the victim’s infrastructure <strong>instantiates an EC2 instance using the compromised AMI</strong>, the attacker gains <strong>execution capabilities</strong> within the AWS account.</p>
</li>
</ul>
</li>
<li>
<p><strong>Potential Consequences</strong></p>
<ul>
<li>
<p><strong>Code Execution &amp; Lateral Movement</strong>: Attackers can execute malicious payloads upon instance launch.</p>
</li>
<li>
<p><strong>Persistent Access</strong>: AMIs can be backdoored, enabling persistent unauthorized access.</p>
</li>
<li>
<p><strong>Credential Theft</strong>: If AWS IAM roles and secrets are exposed within the instance, attackers can pivot into broader AWS services.</p>
</li>
<li>
<p><strong>Supply Chain Compromise</strong>: Cloud workloads built on compromised AMIs introduce systemic vulnerabilities across organizations.</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="real-world-impact-awss-own-infrastructure-was-vulnerable"><strong>Real-World Impact: AWS’s Own Infrastructure Was Vulnerable</strong></h2>
<p>One of the most alarming findings of the whoAMI research was that even <strong>AWS’s internal non-production systems were vulnerable</strong> to this attack.</p>
<h3 id="aws-internal-vulnerability"><strong>AWS Internal Vulnerability</strong></h3>
<p>Datadog Security Labs conducted a controlled experiment to determine whether AWS itself was susceptible to this flaw. They:</p>
<ul>
<li>
<p>Published two benign AMIs <strong>designed to mimic official Amazon Linux images</strong>.</p>
</li>
<li>
<p>Observed <strong>tens of thousands of API requests</strong> retrieving their images, indicating AWS <strong>internal services were fetching AMIs in an insecure manner</strong>.</p>
</li>
</ul>
<p>AWS promptly addressed this issue after disclosure, emphasizing that only <strong>non-production systems were affected</strong> and that <strong>no customer data was at risk</strong>. This incident, however, <strong>highlights the pervasiveness of this vulnerability and its potential for large-scale exploitation</strong>.</p>
<h3 id="extent-of-affected-systems"><strong>Extent of Affected Systems</strong></h3>
<ul>
<li>
<p>Datadog estimated that <strong>approximately 1% of AWS-using organizations</strong> were at risk.</p>
</li>
<li>
<p>Thousands of AWS accounts could be <strong>unknowingly deploying compromised AMIs</strong>.</p>
</li>
</ul>
<hr>
<h2 id="exploitation-demonstration-and-affected-open-source-projects"><strong>Exploitation Demonstration and Affected Open-Source Projects</strong></h2>
<h3 id="example-of-vulnerable-code"><strong>Example of Vulnerable Code</strong></h3>
<p>A typical Terraform configuration that <strong>fails to specify an AMI owner</strong> might look like this:</p>
<p>hclCopyEdit<code>data &quot;aws_ami&quot; &quot;ubuntu&quot; {   most_recent = true   filter {     name   = &quot;name&quot;     values = [&quot;ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*&quot;]   } }</code></p>
<p>In this case, Terraform <strong>fetches the most recent AMI matching the filter</strong>, regardless of who published it.</p>
<h3 id="affected-open-source-tools"><strong>Affected Open-Source Tools</strong></h3>
<p>During their research, Datadog found several <strong>publicly accessible repositories</strong> with vulnerable AMI retrieval patterns. One notable example is <strong>awslabs/aws-simple-ec2-cli</strong>, an AWS-maintained tool designed to simplify EC2 instance management. The tool contained <strong>hardcoded wildcard AMI queries</strong> <strong>without verifying AMI ownership</strong>, making it susceptible to the whoAMI attack.</p>
<hr>
<h2 id="detection-and-mitigation-strategies"><strong>Detection and Mitigation Strategies</strong></h2>
<p>To prevent exploitation, cloud security teams should implement <strong>robust AMI selection controls</strong> and proactively <strong>scan their environments for vulnerabilities</strong>.</p>
<h3 id="detection-how-to-identify-vulnerable-code"><strong>Detection: How to Identify Vulnerable Code</strong></h3>
<ol>
<li>
<p><strong>Codebase Audits</strong></p>
<ul>
<li>
<p>Use <strong>GitHub code search</strong> to identify AMI retrieval queries that <strong>omit owner verification</strong>.</p>
</li>
<li>
<p>Search for patterns like <code>ec2:DescribeImages</code> <strong>without “owners”</strong> filters.</p>
</li>
</ul>
</li>
<li>
<p><strong>Automated Scanning with Semgrep</strong></p>
<ul>
<li>Security teams can leverage <strong>Semgrep rules</strong> to detect unsafe AMI selection logic.</li>
</ul>
</li>
<li>
<p><strong>Cloud SIEM and AWS CloudTrail Monitoring</strong></p>
<ul>
<li>
<p>Implement <strong>Cloud SIEM rules</strong> to <strong>flag suspicious AMI retrievals</strong>.</p>
</li>
<li>
<p>Regularly review <strong>CloudTrail logs</strong> for unexpected AMI launches.</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="mitigation-securing-ami-retrieval-processes"><strong>Mitigation: Securing AMI Retrieval Processes</strong></h2>
<ol>
<li>
<p><strong>Utilize AWS’s Allowed AMIs Feature</strong></p>
<ul>
<li>
<p>In response to this attack, <strong>AWS introduced Allowed AMIs</strong> in December 2024.</p>
</li>
<li>
<p>This feature enables users to <strong>create an allow list of trusted AMI providers</strong>, restricting deployments to verified sources.</p>
</li>
</ul>
</li>
<li>
<p><strong>Explicitly Specify AMI Owners</strong></p>
<ul>
<li>
<p>When querying AMIs, <strong>always specify trusted owner IDs</strong> (e.g., AWS, Canonical, Microsoft).</p>
</li>
<li>
<p>Example of a <strong>secure API query</strong>:bashCopyEdit<code>aws ec2 describe-images --owners &quot;137112412989&quot;</code></p>
</li>
<li>
<p>This ensures that only <strong>Amazon-owned AMIs</strong> are retrieved.</p>
</li>
</ul>
</li>
<li>
<p><strong>Use Datadog’s whoAMI-Scanner</strong></p>
<ul>
<li>Datadog released an <strong>open-source security scanner</strong> to detect and prevent untrusted AMI usage.</li>
</ul>
</li>
<li>
<p><strong>Security Awareness and Policy Enforcement</strong></p>
<ul>
<li>
<p>Cloud security teams should <strong>educate developers</strong> about the risks of untrusted AMIs.</p>
</li>
<li>
<p>Organizations should <strong>enforce IaC security policies</strong> through tools like <strong>AWS Config, Open Policy Agent (OPA), and Terraform Sentinel</strong>.</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="conclusion"><strong>Conclusion</strong></h2>
<p>The <strong>whoAMI attack highlights a critical supply chain risk</strong> in cloud environments, demonstrating how <strong>seemingly benign misconfigurations</strong> can have <strong>severe security implications</strong>. While AWS has introduced <strong>Allowed AMIs</strong> as a mitigation, the responsibility ultimately lies with <strong>organizations to enforce secure cloud practices</strong>.</p>
<p>Security teams must <strong>actively monitor and secure AMI selection processes</strong>, ensuring that infrastructure deployments rely on <strong>trusted and verified resources</strong>. By adopting <strong>proactive security controls</strong>, <strong>automated detection mechanisms</strong>, and <strong>best practices for AMI retrieval</strong>, organizations can effectively <strong>mitigate the risks of name confusion attacks</strong>.</p>
<hr>
<h2 id="key-takeaways-for-cybersecurity-professionals"><strong>Key Takeaways for Cybersecurity Professionals</strong></h2>
<p>
<figure>
  <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/2705.png" alt="✅" />
</figure>


 <strong>Misconfigured AMI queries can lead to remote code execution risks.</strong><br>

<figure>
  <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/2705.png" alt="✅" />
</figure>


 <strong>AWS itself was vulnerable but has since implemented mitigations.</strong><br>

<figure>
  <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/2705.png" alt="✅" />
</figure>


 <strong>Explicitly specifying AMI owners in API calls is a critical best practice.</strong><br>

<figure>
  <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/2705.png" alt="✅" />
</figure>


 <strong>AWS Allowed AMIs feature should be enabled for enhanced security.</strong><br>

<figure>
  <img src="https://s.w.org/images/core/emoji/15.0.3/72x72/2705.png" alt="✅" />
</figure>


 <strong>Organizations must adopt automated scanning tools to detect unsafe AMI selection.</strong></p>
<!-- raw HTML omitted -->
<p>The post The AWS Exploit That Lets Hackers Take Over Your Cloud – Without You Knowing! appeared first on Cyber Security News | Exploit One | Hacking News.</p>
<p>Go to Source</p>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/apple-inc-sent-you-a-payment-request-payoneer-invoices-other-microsoft-enabled-scams/">“Apple Inc sent you a payment request” Payoneer invoices; other Microsoft-enabled scams</a></li>
				
				<li><a href="/posts/glasses-that-transcribe-text-to-audio/">“Glasses” That Transcribe Text To Audio</a></li>
				
				<li><a href="/posts/5-best-linux-centos-replacement-options-alternatives/">&lt;div&gt;5 Best Linux CentOS Replacement Options &amp; Alternatives&lt;/div&gt;</a></li>
				
				<li><a href="/posts/a-week-in-security-march-10-march-16/">&lt;div&gt;A week in security (March 10 – March 16)&lt;/div&gt;</a></li>
				
				<li><a href="/posts/a-week-in-security-march-3-march-9/">&lt;div&gt;A week in security (March 3 – March 9)&lt;/div&gt;</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 <a href="https://ghariib.ir/"><b>Alireza Gharib. All right reserved</b></a>.
	<a href="https://github.com/Gharib110"><b>Github</b></a>.
	</p>
</footer>

</body>
</html>
